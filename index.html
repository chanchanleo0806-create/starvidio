<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Video - í”„ë¦¬ë¯¸ì—„</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>

    <style>
        :root { --main-red: #e94560; --bg-dark: #050505; --card-bg: #16213e; }
        body { font-family: 'Malgun Gothic', sans-serif; background: var(--bg-dark); color: white; margin: 0; overflow-x: hidden; }
        header { background: #1a1a2e; padding: 15px 5%; border-bottom: 2px solid var(--main-red); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .logo { color: var(--main-red); cursor: pointer; text-shadow: 0 0 10px var(--main-red); margin:0; }
        .btn { background: var(--main-red); border: none; color: white; padding: 8px 18px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { transform: scale(1.1); }
        .container { padding: 20px 5%; }
        
        /* ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ */
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px; }
        .v-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; cursor: pointer; border: 1px solid #222; position: relative; }
        .v-card img { width: 100%; height: 150px; object-fit: cover; }
        
        /* ì‡¼ì¸  ë ˆì´ì•„ì›ƒ */
        #shorts-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; z-index: 3000; flex-direction: column; overflow-y: scroll; scroll-snap-type: y mandatory; }
        .short-video-wrapper { width: 100%; height: 100vh; scroll-snap-align: start; display: flex; justify-content: center; align-items: center; position: relative; }
        .short-video-wrapper video { height: 100%; max-width: 100%; object-fit: cover; }
        .shorts-close { position: fixed; top: 20px; right: 20px; z-index: 3001; font-size: 40px; color: white; cursor: pointer; }

        /* í”Œë ˆì´ì–´ ë° ëª¨ë‹¬ */
        .player-box { width: 100%; max-width: 850px; aspect-ratio: 16/9; background: #000; margin: 0 auto 20px; position: relative; border-radius: 15px; overflow: hidden; }
        #ad-box { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:100; }
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center; z-index:2000; }
        .modal-content { background:#1a1a2e; padding:30px; border-radius:20px; border:2px solid var(--main-red); width:300px; text-align:center; }
        input { width:90%; padding:10px; margin:10px 0; border-radius:5px; border:none; background:#0f3460; color:white; }
    </style>
</head>
<body>

<header>
    <h2 class="logo" onclick="location.reload()">â˜… Star Video</h2>
    <div id="auth-section">
        <button class="btn" style="background:#ff4757; margin-right:10px;" onclick="openShorts()">ğŸ¬ ì‡¼ì¸ </button>
        <button class="btn" onclick="openModal('login-modal')">ë¡œê·¸ì¸</button>
    </div>
    <div id="user-section" style="display:none; align-items:center; gap:15px;">
        <button class="btn" style="background:#ff4757;" onclick="openShorts()">ğŸ¬ ì‡¼ì¸ </button>
        <button class="btn" style="background:#4caf50;" onclick="document.getElementById('file-input').click()">ì—…ë¡œë“œ</button>
        <button class="btn" style="background:#444;" onclick="location.reload()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</header>

<div class="container">
    <div class="player-box">
        <div id="ad-box">
            <h2 style="color:var(--main-red)">AD: í”„ë¦¬ë¯¸ì—„ ê´‘ê³ </h2>
            <p id="ad-timer">5ì´ˆ í›„ ì˜ìƒì´ ì‹œì‘ë©ë‹ˆë‹¤</p>
            <button id="skip-btn" disabled class="btn" style="background:#555;">ê±´ë„ˆë›°ê¸°</button>
        </div>
        <div id="video-display" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#555; background:#111;">ì˜ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”</div>
    </div>
    <h3>ì¶”ì²œ ì½˜í…ì¸ </h3>
    <div class="video-grid" id="main-grid"></div>
</div>

<div id="shorts-container">
    <div class="shorts-close" onclick="closeShorts()">Ã—</div>
    <div id="shorts-list"></div>
</div>

<div id="login-modal" class="modal"><div class="modal-content">
    <h2>ë¡œê·¸ì¸</h2>
    <input type="text" id="l-id" placeholder="ì•„ì´ë””">
    <input type="password" id="l-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button class="btn" style="width:100%" onclick="handleLogin()">ë¡œê·¸ì¸</button>
    <p onclick="openModal('signup-modal'); closeModal('login-modal')" style="color:var(--main-red); cursor:pointer; margin-top:10px;">íšŒì›ê°€ì… í•˜ê¸°</p>
</div></div>

<div id="signup-modal" class="modal"><div class="modal-content">
    <h2>íšŒì›ê°€ì…</h2>
    <input type="text" id="s-id" placeholder="ì•„ì´ë””">
    <input type="text" id="s-nick" placeholder="ë‹‰ë„¤ì„">
    <input type="password" id="s-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button class="btn" style="width:100%" onclick="handleSignup()">ê°€ì…ì™„ë£Œ</button>
    <p onclick="closeModal('signup-modal')" style="color:#aaa; cursor:pointer; margin-top:10px;">ë‹«ê¸°</p>
</div></div>

<input type="file" id="file-input" style="display:none" accept="video/*">

<script>
    // --- ì„¤ì • (ë‚´ ì •ë³´ë¡œ ë°”ê¾¸ê¸°) ---
    const firebaseConfig = {
        apiKey: "AIzaSyA-Qkz57KR0i55lTbrsu0rZk282-ma_4MA",
        authDomain: "star-vidio.firebaseapp.com",
        projectId: "star-vidio",
        storageBucket: "star-vidio.firebasestorage.app",
        messagingSenderId: "1035567764991",
        appId: "1:1035567764991:web:4fd92a5591da039da503ca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
    const BANNED_WORDS = ["ìš•ì„¤", "ë‚˜ìœë§"]; 
    let currentUser = null;

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // --- íšŒì›ê°€ì… (ì¤‘ë³µì²´í¬) ---
    async function handleSignup() {
        const id = document.getElementById('s-id').value;
        const nick = document.getElementById('s-nick').value;
        const pw = document.getElementById('s-pw').value;
        if(!id || !nick || !pw) return alert("ë¹ˆì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”!");

        const check = await db.collection("users").doc(id).get();
        if(check.exists) return alert("ì´ë¯¸ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤!");

        await db.collection("users").doc(id).set({id, nick, pw});
        alert("ê°€ì… ì„±ê³µ!");
        closeModal('signup-modal');
    }

    // --- ë¡œê·¸ì¸ ---
    async function handleLogin() {
        const id = document.getElementById('l-id').value;
        const pw = document.getElementById('l-pw').value;
        const doc = await db.collection("users").doc(id).get();
        if(doc.exists && doc.data().pw === pw) {
            currentUser = doc.data();
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('user-section').style.display = 'flex';
            closeModal('login-modal');
        } else { alert("ì •ë³´ê°€ í‹€ë¦½ë‹ˆë‹¤!"); }
    }

    // --- ì—…ë¡œë“œ (ê²€ì—´) ---
    document.getElementById('file-input').onchange = async (e) => {
        const file = e.target.files[0];
        if(!file) return;
        if(BANNED_WORDS.some(w => file.name.includes(w))) return alert("ê¸ˆì§€ì–´ê°€ í¬í•¨ë¨!");

        alert("ì„œë²„ ì „ì†¡ ì¤‘...");
        const ref = storage.ref('videos/' + Date.now() + "_" + file.name);
        await ref.put(file);
        const url = await ref.getDownloadURL();
        await db.collection("videos").add({
            title: file.name, url, uploader: currentUser.nick,
            reportCount: 0, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert("ì—…ë¡œë“œ ì„±ê³µ!");
    };

    // --- ì‹ ê³  ê¸°ëŠ¥ ---
    async function reportVideo(id) {
        if(!confirm("ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const ref = db.collection("videos").doc(id);
        const doc = await ref.get();
        const count = (doc.data().reportCount || 0) + 1;
        await ref.update({reportCount: count});
        alert("ì‹ ê³ ì™„ë£Œ (5íšŒ ëˆ„ì  ì‹œ ì‚­ì œ)");
    }

    // --- ëª©ë¡ ì¶œë ¥ ---
    db.collection("videos").orderBy("createdAt", "desc").onSnapshot(snap => {
        const grid = document.getElementById('main-grid');
        grid.innerHTML = '';
        snap.forEach(doc => {
            const v = doc.data();
            if(v.reportCount >= 5) return;
            const div = document.createElement('div');
            div.className = 'v-card';
            div.innerHTML = `<img src="https://via.placeholder.com/300x170/16213e/fff?text=StarVideo"><div style="padding:10px;"><h4>${v.title}</h4><p>${v.uploader} <span onclick="event.stopPropagation(); reportVideo('${doc.id}')" style="color:red; cursor:pointer; font-size:10px;">ğŸš¨ì‹ ê³ </span></p></div>`;
            div.onclick = () => startPlay(v);
            grid.appendChild(div);
        });
    });

    // --- ì‡¼ì¸  ì—´ê¸° ---
    async function openShorts() {
        const container = document.getElementById('shorts-container');
        const list = document.getElementById('shorts-list');
        container.style.display = 'flex';
        list.innerHTML = '';
        const snap = await db.collection("videos").get();
        snap.forEach(doc => {
            if(doc.data().reportCount >= 5) return;
            const div = document.createElement('div');
            div.className = 'short-video-wrapper';
            div.innerHTML = `<video src="${doc.data().url}" loop autoplay muted onclick="this.paused?this.play():this.pause()"></video>`;
            list.appendChild(div);
        });
    }
    function closeShorts() { document.getElementById('shorts-container').style.display = 'none'; }

    function startPlay(v) {
        const ad = document.getElementById('ad-box');
        ad.style.display = 'flex';
        let t = 5;
        const itv = setInterval(() => {
            t--;
            document.getElementById('ad-timer').innerText = t + "ì´ˆ í›„ ì‹œì‘";
            if(t <= 0) {
                clearInterval(itv);
                document.getElementById('skip-btn').disabled = false;
                document.getElementById('skip-btn').style.background = "red";
            }
        }, 1000);
        document.getElementById('skip-btn').onclick = () => {
            ad.style.display = 'none';
            document.getElementById('video-display').innerHTML = `<video src="${v.url}" controls autoplay style="width:100%; height:100%"></video>`;
        }
    }
</script>
</body>
</html>