// --- [ì•„ì´ë”” ì—°ë™ì˜ í•µì‹¬: í†µí•© íšŒì›ê°€ì…] ---
window.handleSignup = async () => {
    const id = document.getElementById('log-id').value.trim().toLowerCase();
    const pw = document.getElementById('log-pw').value.trim();
    const nick = id; // ì´ˆê¸° ë‹‰ë„¤ì„ì€ ì•„ì´ë””ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •

    if(!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");

    try {
        // 1. Firestore(ë¹„ë””ì˜¤ ì„œë²„) ì¤‘ë³µ ì²´í¬ ë° ì €ì¥
        const firestoreRef = db.collection("users").doc(id);
        const check = await firestoreRef.get();
        if(check.exists) return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤!");

        // 2. í†µí•© ì €ì¥ ì‹¤í–‰ (ë¹„ë””ì˜¤ ì„œë²„ & ì±„íŒ… ì„œë²„ ì–‘ìª½ ì €ì¥)
        await Promise.all([
            // ë¹„ë””ì˜¤/ì‡¼ì¸ ìš© ìœ ì € ì •ë³´ (Firestore)
            firestoreRef.set({ id, pw, nick, createdAt: new Date() }),
            
            // ì±„íŒ…/ì¹œêµ¬ìš© ìœ ì € ì •ë³´ (Realtime Database)
            rdb.ref(`users/${id}`).set({ id, pw, nick })
        ]);

        alert("ğŸ‰ ìŠ¤íƒ€ í†µí•© íšŒì›ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.");
    } catch (e) {
        console.error(e);
        alert("ì—°ë™ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.message);
    }
};

// --- [ì•„ì´ë”” ì—°ë™ì˜ í•µì‹¬: í†µí•© ë¡œê·¸ì¸] ---
window.handleLogin = async () => {
    const id = document.getElementById('log-id').value.trim().toLowerCase();
    const pw = document.getElementById('log-pw').value.trim();

    try {
        // Firestoreì—ì„œ ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const doc = await db.collection("users").doc(id).get();
        
        if(doc.exists && doc.data().pw === pw) {
            currentUser = doc.data(); // ì „ì—­ ë³€ìˆ˜ì— ìœ ì € ì •ë³´ ì €ì¥
            
            // ë¡œê·¸ì¸ ìƒíƒœ ë¸Œë¼ìš°ì €ì— ì €ì¥ (ìƒˆë¡œê³ ì¹¨ ëŒ€ë¹„)
            localStorage.setItem('star_user_id', id);
            
            // UI ì „í™˜
            document.getElementById('auth-ui').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            // ë°ì´í„° ë¡œë“œ ì‹œì‘
            loadVideos();  // ë¹„ë””ì˜¤ í”¼ë“œ
            loadFriends(); // ì±„íŒ… ì¹œêµ¬ ëª©ë¡
            console.log("âœ… ID ì—°ë™ ë¡œê·¸ì¸ ì„±ê³µ:", id);
        } else {
            alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤.");
        }
    } catch (e) {
        alert("ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
    }
};
